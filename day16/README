Run part2 at own risk, it took me about 6 hours to get the correct output. No time to make it better :(